<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ææ–™ç®¡ç†ç³»çµ± v2.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    :root {
      --ukiyo-deep-blue: #1D3B56;
      --ukiyo-mid-blue: #2A587A;
      --ukiyo-light-blue: #6B93B8;
      --ukiyo-foam: #F0F4F5;
      --ukiyo-sky: #E6D3A3;
      --ukiyo-paper: #F2E6D9;
      --glass-bg: rgba(255, 255, 255, 0.95);
      --glass-border: rgba(255, 255, 255, 0.9);
      --danger-red: #d64545;
      --safe-green: #2ecc71;
      --warning-orange: #f39c12;
      --excel-green: #217346;
    }
    
    body {
      font-family: 'Noto Sans TC', sans-serif;
      margin: 0;
      padding: 0;
      color: #1a202c;
      background-color: var(--ukiyo-sky);
      min-height: 100vh;
      overflow-x: hidden; /* é˜²æ­¢æ‰‹æ©Ÿæ©«å‘æ»¾å‹• */
    }

    /* èƒŒæ™¯å‹•ç•«å±¤ */
    .ukiyo-scene {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 1; overflow: hidden;
      background: radial-gradient(circle at 50% 30%, #f7f0e6, var(--ukiyo-sky));
      pointer-events: none;
    }
    .mt-fuji {
      position: absolute; bottom: 25%; left: 50%; transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 150px solid transparent; border-right: 150px solid transparent;
      border-bottom: 200px solid #2c3e50;
    }
    .wave { position: absolute; bottom: 0; width: 200%; height: 100%; background-repeat: repeat-x; background-position: bottom; }
    .wave-back { z-index: 2; height: 45%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 180' preserveAspectRatio='none'%3E%3Cpath d='M0,120 C150,150 250,80 400,110 C550,140 650,80 800,110 L800,180 L0,180 Z' fill='%232A587A' opacity='0.8'/%3E%3C/svg%3E"); animation: moveWave 25s linear infinite; }
    .wave-mid { z-index: 3; height: 40%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 180' preserveAspectRatio='none'%3E%3Cpath d='M0,100 C200,60 350,140 600,80 C750,40 800,100 800,100 L800,180 L0,180 Z' fill='%236B93B8' opacity='0.9'/%3E%3C/svg%3E"); animation: moveWave 15s linear infinite reverse; }
    .wave-front { z-index: 4; height: 35%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320' preserveAspectRatio='none'%3E%3Cpath fill='%231D3B56' fill-opacity='1' d='M0,160L48,176C96,192,192,224,288,224C384,224,480,192,576,165.3C672,139,768,117,864,128C960,139,1056,181,1152,197.3C1248,213,1344,203,1392,197.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E"); animation: moveWave 10s linear infinite; }
    @keyframes moveWave { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    /* Excel åŒ¯å‡ºæŒ‰éˆ• (ä¿®æ­£æ‰‹æ©Ÿç‰ˆä½ç½®) */
    .excel-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background-color: var(--excel-green);
      color: white;
      border: 2px solid white;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 900;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    .excel-btn:hover {
      transform: scale(1.05);
      background-color: #1e6b40;
    }

    /* Modal (å½ˆçª—) æ¨£å¼ (ä¿®æ­£æ‰‹æ©Ÿç‰ˆå¯¬åº¦) */
    .modal-overlay {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      padding: 10px; /* å¢åŠ é‚Šè· */
      box-sizing: border-box;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 15px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      position: relative;
      max-height: 90vh; /* é˜²æ­¢è¶…å‡ºé«˜åº¦ */
      overflow-y: auto; /* å…§å®¹éé•·å¯æ²å‹• */
    }
    .modal-header {
      font-size: 1.2rem;
      font-weight: 900;
      margin-bottom: 15px;
      color: var(--ukiyo-deep-blue);
      border-bottom: 2px solid var(--ukiyo-sky);
      padding-bottom: 10px;
    }
    .modal-body {
      margin-bottom: 20px;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
    }
    .checkbox-item:hover { background: #f0f0f0; }
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    .btn-modal-cancel { background: #ccc; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn-modal-confirm { background: var(--excel-green); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

    /* UI å…§å®¹å±¤ */
    .content-wrapper { 
      position: relative; z-index: 10; padding: 20px 16px 80px; 
      max-width: 950px; margin: 0 auto;
    }

    header { 
      background: var(--ukiyo-deep-blue); color: white; border-radius: 12px; 
      padding: 20px; text-align: center; box-shadow: 0 10px 25px rgba(29, 59, 86, 0.5); 
      border: 2px solid #D4AF37; margin-bottom: 25px;
    }

    /* Tab å°èˆªåˆ— (ä¿®æ­£æ‰‹æ©Ÿå¯æ»‘å‹•) */
    .nav-tabs {
      display: flex; gap: 10px; margin-bottom: 20px; 
      overflow-x: auto; /* å…è¨±æ©«å‘æ»‘å‹• */
      padding-bottom: 5px; /* é ç•™æ²è»¸ç©ºé–“ */
      -webkit-overflow-scrolling: touch;
      flex-wrap: nowrap; /* ä¸æ›è¡Œ */
    }
    .nav-btn {
      flex: 0 0 auto; /* ä¸å£“ç¸® */
      padding: 12px; border: none; border-radius: 8px;
      background: rgba(255,255,255,0.6); font-weight: 700; color: var(--ukiyo-deep-blue);
      cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      white-space: nowrap; /* æ–‡å­—ä¸æ›è¡Œ */
    }
    .nav-btn.active {
      background: var(--ukiyo-deep-blue); color: #fff;
      transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    /* ç‰¹åˆ¥æ¨™è¨»é€²è²¨èª¿æ’¥æŒ‰éˆ• */
    .nav-btn-transfer { border-bottom: 3px solid var(--warning-orange); }
    /* æ–°åŠŸèƒ½æŒ‰éˆ• */
    .nav-btn-history { border-bottom: 3px solid #8e44ad; }

    .container-3d { 
      background: var(--glass-bg); backdrop-filter: blur(10px); 
      border-radius: 20px; padding: 30px; 
      box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
      border: 1px solid var(--glass-border); margin-bottom: 30px;
      display: none; 
    }
    .container-3d.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    h3.section-title { color: var(--ukiyo-deep-blue); border-left: 6px solid var(--danger-red); padding-left: 15px; margin: 25px 0 15px; font-weight: 900; }
    input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; box-sizing: border-box; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1.2fr; gap: 15px; margin-bottom: 15px; }
    
    /* æŒ‰éˆ•æ¨£å¼ */
    .btn-save { 
      width: 100%; padding: 15px; border: none; border-radius: 12px; 
      background: linear-gradient(45deg, var(--ukiyo-deep-blue), var(--ukiyo-mid-blue)); 
      color: white; font-size: 1.1rem; font-weight: 900; cursor: pointer; 
      transition: 0.3s; margin-top: 10px;
    }
    .btn-save:hover { background: var(--danger-red); transform: translateY(-2px); }
    
    .btn-search {
      background: var(--ukiyo-mid-blue); color: white; padding: 12px; 
      border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
    }

    /* åˆ—è¡¨èˆ‡è¡¨æ ¼æ¨£å¼ */
    .materials-container { 
      display: flex; flex-direction: column; gap: 8px; 
      max-height: 200px; overflow-y: auto; 
      padding: 10px; border: 1px solid #ddd; border-radius: 8px; 
      background: white; margin-top: 10px;
    }
    .material-btn { 
      padding: 10px; background: #f9f9f9; border: 1px solid #eee; 
      cursor: pointer; border-radius: 6px; text-align: left; transition: 0.2s;
    }
    .material-btn:hover { background: #eef2f5; }
    .material-btn.active { background: var(--ukiyo-mid-blue); color: white; }

    .record-li { 
      background: white; border-radius: 12px; padding: 15px; 
      margin-bottom: 12px; border-left: 5px solid var(--ukiyo-mid-blue); 
      position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
    }
    .btn-delete { 
      position: absolute; right: 15px; top: 15px; background: #ffeaea; 
      border: 1px solid #ffcccc; color: red; cursor: pointer; 
      padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;
    }

    /* åº«å­˜è¡¨æ ¼ */
    .stock-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .stock-table th, .stock-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .stock-table th { background-color: var(--ukiyo-foam); color: var(--ukiyo-deep-blue); white-space: nowrap; }
    .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; color: white; white-space: nowrap; }
    .status-ok { background-color: var(--safe-green); }
    .status-low { background-color: var(--danger-red); }
    .status-warn { background-color: var(--warning-orange); }

    /* æ­·å²ç´€éŒ„åˆ†æå¡ç‰‡ */
    .history-card {
        background: #fff; border-radius: 12px; padding: 15px;
        margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        border: 1px solid #eee;
    }
    .history-stat-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;
    }
    .stat-box {
        background: var(--ukiyo-foam); padding: 10px; border-radius: 8px; text-align: center;
    }
    .stat-val { font-size: 1.2rem; font-weight: 900; color: var(--ukiyo-deep-blue); }
    .stat-label { font-size: 0.8rem; color: #666; }

    /* æ¨¡å¼åˆ‡æ› Toggle */
    .mode-toggle {
      display: flex; background: #ddd; border-radius: 10px; padding: 5px; margin-bottom: 20px;
    }
    .mode-btn {
      flex: 1; padding: 10px; text-align: center; cursor: pointer; border-radius: 8px; font-weight: bold; font-size: 0.9rem;
    }
    .mode-btn.active { background: white; color: var(--ukiyo-deep-blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    /* ç°½åæª” */
    .ukiyo-signature {
      position: fixed; left: 20px; bottom: 20px; z-index: 100; font-weight: 900; padding: 10px;
      background: #F2E6D9; border: 2px solid #1D3B56; border-radius: 5px; transform: rotate(-5deg); cursor: pointer;
      box-shadow: 3px 3px 0px #1D3B56;
    }

    @media (max-width: 600px) { 
      .form-row, .form-row-3 { grid-template-columns: 1fr; } 
      .nav-btn { font-size: 0.9rem; padding: 8px 12px; }
      .excel-btn { top: auto; bottom: 80px; right: 20px; left: auto; border-radius: 50%; width: 50px; height: 50px; padding: 0; justify-content: center; }
      .excel-btn span { display: none; }
      .excel-btn::after { content: "ğŸ“Š"; font-size: 1.5rem; }
      .checkbox-grid { grid-template-columns: 1fr; }
      .container-3d { padding: 20px; }
      .stock-table th, .stock-table td { font-size: 0.85rem; padding: 8px; }
    }
  </style>
</head>
<body>

  <button class="excel-btn" onclick="openExportModal()">
    <span>ğŸ“Š åŒ¯å‡ºè³‡æ–™</span>
  </button>

  <div id="exportModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">åŒ¯å‡ºé¸é …è¨­å®š</div>
      <div class="modal-body">
        <div style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 8px;">
           <label style="font-weight:bold; display:block; margin-bottom:5px;">ğŸ“… æ—¥æœŸç¯„åœ (ç•™ç©ºå‰‡åŒ¯å‡ºå…¨éƒ¨)</label>
           <div style="display:flex; gap:10px;">
             <input type="date" id="exportStart">
             <span style="align-self:center;">~</span>
             <input type="date" id="exportEnd">
           </div>
        </div>
        
        <label style="font-weight:bold; display:block; margin-bottom:10px;">ğŸ“ é¸æ“‡è¦åŒ¯å‡ºçš„æ¬„ä½ï¼š</label>
        <div class="checkbox-grid">
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="date" checked> ç•°å‹•æ—¥æœŸ</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="type" checked> ä½œæ¥­é¡å‹</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="orderNo" checked> å–®è™Ÿ</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="partNo" checked> æ–™è™Ÿ</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="name" checked> å“å/è¦æ ¼</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="qty" checked> æ•¸é‡</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="unit" checked> å–®ä½</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="person" checked> å°è±¡(äºº/å–®ä½)</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="staff" checked> ç¶“è¾¦äºº</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="evalType"> è©•åƒ¹é¡å‹</label>
          <label class="checkbox-item"><input type="checkbox" class="export-col" value="timestamp"> ç´€éŒ„æ™‚é–“æˆ³è¨˜</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-modal-cancel" onclick="closeExportModal()">å–æ¶ˆ</button>
        <button class="btn-modal-confirm" onclick="confirmExport()">ç¢ºèªåŒ¯å‡º</button>
      </div>
    </div>
  </div>

  <div class="ukiyo-scene">
    <div class="mt-fuji"></div>
    <div class="wave wave-back"></div>
    <div class="wave wave-mid"></div>
    <div class="wave wave-front"></div>
  </div>

  <div class="content-wrapper">
    <header>
      <div style="font-weight:900; font-size: 1.5rem; letter-spacing: 2px;">ææ–™ç®¡ç†ç³»çµ±</div>
    </header>

    <div class="nav-tabs">
      <button class="nav-btn active" onclick="switchTab('input')">ğŸ“ è³‡æ–™è¼¸å…¥</button>
      <button class="nav-btn" onclick="switchTab('search')">ğŸ” æ­·å²æŸ¥è©¢</button>
      <button class="nav-btn" onclick="switchTab('inventory')">ğŸ“¦ å³æ™‚åº«å­˜</button>
      <button class="nav-btn nav-btn-transfer" onclick="switchTab('transfer')">ğŸšš é€²è²¨/èª¿æ’¥</button>
      <button class="nav-btn nav-btn-history" onclick="switchTab('history')">ğŸ“œ æ­·å²ç”¨æ–™ç´€éŒ„</button>
      <button class="nav-btn" onclick="switchTab('analysis')">ğŸ“Š åˆ†æèˆ‡é æ¸¬</button>
    </div>

    <div id="tab-input" class="container-3d active">
      <form id="materialForm">
        <h3 class="section-title">å£¹ã€åŸºæœ¬è³‡è¨Š</h3>
        <div class="form-row">
          <div><label>ç•°å‹•æ—¥æœŸ</label><input type="date" id="mainDate" required /></div>
          <div><label>ä½œæ¥­é¡å‹</label>
            <select id="transType">
              <option value="é ˜æ–™">é ˜æ–™ (Take)</option>
              <option value="å€Ÿç”¨">å€Ÿç”¨ (Borrow)</option>
              <option value="é€€æ–™">é€€æ–™ (Return)</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div><label>å–®è™Ÿ</label><input type="text" id="orderNo" placeholder="è«‹è¼¸å…¥å–®è™Ÿ" required /></div>
          <div><label>é ˜/é€€/å€Ÿç”¨äººå§“å</label><input type="text" id="personName" required /></div>
        </div>
        
        <div class="form-row">
          <div><label>ç™¼/æ”¶æ–™ç¶“è¾¦äºº</label><input type="text" id="staffName" required /></div>
          <div><label>10ä½æ–™è™Ÿæœå°‹ (å¸¶å‡ºææ–™)</label><input type="text" id="partNoInput" maxlength="10" placeholder="è¼¸å…¥æ–™è™Ÿè‡ªå‹•å¸¶å‡º" oninput="handlePartNoInput(this.value, 'normal')" /></div>
        </div>

        <h3 class="section-title">è²³ã€ææ–™é¸æ“‡</h3>
        <select id="category" onchange="renderMaterials('input')">
          <option value="">-- è«‹é¸æ“‡ææ–™é¡åˆ¥ --</option>
          <option value="A">A é¡ (ç¤™å­)</option>
          <option value="B">B é¡ (éµä»¶)</option>
          <option value="C">C é¡ (ç·šæ)</option>
          <option value="F">F é¡ (è®Šå£“å™¨)</option>
          <option value="H">H é¡ (é–‹é—œ)</option>
          <option value="D">D é¡ (é›»è¡¨)</option>
        </select>

        <div id="materialsContainer_input" class="materials-container">
          <div style="color:#888; text-align:center; padding:20px;">è«‹å…ˆé¸æ“‡é¡åˆ¥æˆ–è¼¸å…¥æ–™è™Ÿ</div>
        </div>

        <div id="qtySection" style="display:none; margin-top:20px;">
          <div class="form-row-3">
            <div><label>æ•¸é‡</label><input type="number" id="qty" min="1" required /></div>
            <div><label>å–®ä½</label><input type="text" id="unit" required /></div>
            <div><label>è©•åƒ¹é¡å‹</label>
              <select id="evalType">
                <option value="0æ–°">0æ–°</option>
                <option value="1èˆŠ">1èˆŠ</option>
                <option value="2å¾…ä¿®é©—">2å¾…ä¿®é©—</option>
                <option value="3è³‡ç”¢æ–°">3è³‡ç”¢æ–°</option>
                <option value="4è³‡ç”¢èˆŠ">4è³‡ç”¢èˆŠ</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn-save">ğŸ’¾ å„²å­˜ç‰©æ–™ç´€éŒ„</button>
        </div>
      </form>
    </div>

    <div id="tab-search" class="container-3d">
      <h3 class="section-title">ğŸ” é€²éšæ­·å²æœå°‹</h3>
      <div class="form-row">
        <div><label>å§“åæœå°‹ (é ˜/é€€/å€Ÿ)</label><input type="text" id="searchPerson" placeholder="è¼¸å…¥å§“å..." oninput="filterRecords()"></div>
        <div><label>ç¶“è¾¦äººæœå°‹ (æ”¶/ç™¼)</label><input type="text" id="searchStaff" placeholder="è¼¸å…¥ç¶“è¾¦äºº..." oninput="filterRecords()"></div>
      </div>
      <div class="form-row">
        <div><label>æ–™è™Ÿæœå°‹</label><input type="text" id="searchPartNo" placeholder="è¼¸å…¥æ–™è™Ÿ..." oninput="filterRecords()"></div>
        <div><label>æ—¥æœŸéæ¿¾ (å¹´/æœˆ)</label><input type="month" id="searchMonth" onchange="filterRecords()"></div>
      </div>
      <button onclick="clearFilters()" style="width:100%; margin-bottom:15px; padding:10px; background:#eee; border:none; border-radius:8px; cursor:pointer;">âŒ æ¸…é™¤æœå°‹æ¢ä»¶</button>
      
      <div id="logList"></div>
    </div>

    <div id="tab-inventory" class="container-3d">
      <h3 class="section-title">ğŸ“¦ åº«å­˜è¨­å®šèˆ‡æŸ¥è©¢</h3>
      <div class="form-row-3" style="background: var(--ukiyo-foam); padding:15px; border-radius:10px; margin-bottom:20px;">
        <div style="grid-column: 1 / -1;"><strong>ğŸ”§ è¨­å®šåˆå§‹åº«å­˜</strong></div>
        
        <div style="grid-column: 1 / -1; margin-bottom: 10px;">
             <label>é¸æ“‡é¡åˆ¥ (è¼”åŠ©å¸¶å…¥)</label>
             <select id="category_stock" onchange="renderMaterials('stock')">
              <option value="">-- è«‹é¸æ“‡ææ–™é¡åˆ¥ --</option>
              <option value="A">A é¡ (ç¤™å­)</option>
              <option value="B">B é¡ (éµä»¶)</option>
              <option value="C">C é¡ (ç·šæ)</option>
              <option value="F">F é¡ (è®Šå£“å™¨)</option>
              <option value="H">H é¡ (é–‹é—œ)</option>
              <option value="D">D é¡ (é›»è¡¨)</option>
            </select>
            <div id="materialsContainer_stock" class="materials-container" style="display:none; margin-bottom:10px;"></div>
        </div>

        <div><label>æ–™è™Ÿ</label><input type="text" id="stockPartNo" placeholder="è¼¸å…¥æˆ–é¸æ“‡..." oninput="handleStockPartNoInput(this.value)"></div>
        <div><label>åˆå§‹æ•¸é‡</label><input type="number" id="stockInitQty" placeholder="0"></div>
        <div><label>å‹•ä½œ</label><button class="btn-search" style="width:100%" onclick="setInitialStock()">è¨­å®š/æ›´æ–°</button></div>
        <div style="grid-column: 1 / -1;"><small style="color:#666">ç›®å‰é¸æ“‡: <span id="stockSelectedName">ç„¡</span></small></div>
      </div>
      
      <div><label>ğŸ” å¿«é€Ÿéæ¿¾åº«å­˜è¡¨</label><input type="text" id="filterStockInput" placeholder="è¼¸å…¥æ–™è™Ÿæˆ–å“å..." oninput="renderInventoryTable()"></div>
      
      <div style="overflow-x: auto;">
        <table class="stock-table">
          <thead>
            <tr>
              <th>æ–™è™Ÿ</th>
              <th>å“å</th>
              <th>åˆå§‹</th>
              <th>ç•°å‹•ç¸½è¨ˆ</th>
              <th>ç›®å‰åº«å­˜</th>
            </tr>
          </thead>
          <tbody id="inventoryBody"></tbody>
        </table>
      </div>
    </div>

    <div id="tab-transfer" class="container-3d">
      <h3 class="section-title">ğŸšš é€²è²¨ / èª¿æ’¥ / ç§»è½‰</h3>
      
      <div class="mode-toggle">
        <div id="modeStockIn" class="mode-btn active" onclick="setTransferMode('stockin')">ğŸ“¥ é€²è²¨å…¥åº« (å» å•†/ç¸½è™•)</div>
        <div id="modeTransfer" class="mode-btn" onclick="setTransferMode('transfer')">â‡† å–®ä½é–“èª¿æ’¥</div>
        <div id="modeWarehouse" class="mode-btn" onclick="setTransferMode('warehouse')">ğŸ­ å€‰åº«é–“ç§»è½‰</div>
      </div>

      <div style="background: #eef2f5; padding: 20px; border-radius: 12px; border: 1px solid #ccc;">
        <div class="form-row">
            <div><label>ç•°å‹•æ—¥æœŸ</label><input type="date" id="transferDate"></div>
            <div><label>å–®è™Ÿ</label><input type="text" id="transferOrderNo" placeholder="è«‹è¼¸å…¥å–®è™Ÿ"></div>
        </div>

        <div class="form-row">
            <div><label>10ä½æ–™è™Ÿæœå°‹ (å¿…å¡«)</label><input type="text" id="transferPartNo" maxlength="10" placeholder="è¼¸å…¥æ–™è™Ÿå¸¶å‡ºåç¨±" oninput="handlePartNoInput(this.value, 'transfer')"></div>
            <div><label>å“åè¦æ ¼ (è‡ªå‹•é¡¯ç¤º)</label><input type="text" id="transferItemName" disabled style="background: #e0e0e0; font-weight:bold;"></div>
        </div>

        <div id="stockInFields">
            <div class="form-row">
                <div><label>å…¥åº«æ•¸é‡</label><input type="number" id="stockInQty" min="1" placeholder="ä¾‹å¦‚: 10"></div>
                <div><label>ç¶“è¾¦äºº</label><input type="text" id="stockInStaff" placeholder="æ‚¨çš„å§“å"></div>
            </div>
            <button class="btn-save" style="background: linear-gradient(45deg, #11998e, #38ef7d);" onclick="processStockIn()">ğŸ“¥ ç¢ºèªå…¥åº« (å…¥å¸³)</button>
        </div>

        <div id="transferFields" style="display:none;">
            <div class="form-row">
                <div><label>å°æ–¹å–®ä½åç¨±</label><input type="text" id="transferTargetUnit" placeholder="ä¾‹: å°åŒ—è¥¿å€ç‡Ÿæ¥­è™•"></div>
                <div><label>èª¿æ’¥é¡å‹</label>
                    <select id="transferType">
                        <option value="transfer_in">èª¿å…¥ (æœ¬å–®ä½å¢åŠ  +)</option>
                        <option value="transfer_out">èª¿å‡º (æœ¬å–®ä½æ¸›å°‘ -)</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div><label>èª¿æ’¥æ•¸é‡</label><input type="number" id="transferQty" min="1"></div>
                <div><label>ç¶“è¾¦äºº</label><input type="text" id="transferStaff"></div>
            </div>
            <button class="btn-save" style="background: linear-gradient(45deg, #f7971e, #ffd200);" onclick="processTransfer()">â‡† ç¢ºèªèª¿æ’¥</button>
        </div>

        <div id="warehouseFields" style="display:none;">
            <div class="form-row">
                <div><label>ç›®æ¨™/ä¾†æº å€‰åº«åç¨±</label>
                    <select id="warehouseTarget">
                        <option value="21M1æœ¬åº«å€‰">21M1æœ¬åº«å€‰</option>
                        <option value="21M6å¾…ä¿®é©—å€‰">21M6å¾…ä¿®é©—å€‰</option>
                        <option value="21M2å»¢æ–™å€‰">21M2å»¢æ–™å€‰</option>
                        <option value="21M3ä¿ç•™å€‰">21M3ä¿ç•™å€‰</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div><label>ç§»è½‰é¡å‹</label>
                    <select id="warehouseType">
                        <option value="transfer_out">ç§»å‡º (ç§»è‡³è©²å€‰ -)</option>
                        <option value="transfer_in">ç§»å…¥ (å¾è©²å€‰ç§»å…¥ +)</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div><label>ç§»è½‰æ•¸é‡</label><input type="number" id="warehouseQty" min="1"></div>
                <div><label>ç¶“è¾¦äºº</label><input type="text" id="warehouseStaff"></div>
            </div>
            <button class="btn-save" style="background: linear-gradient(45deg, #4b6cb7, #182848);" onclick="processWarehouseTransfer()">ğŸ­ ç¢ºèªç§»è½‰</button>
        </div>

      </div>
    </div>

    <div id="tab-history" class="container-3d">
        <h3 class="section-title">ğŸ“œ æ­·å²ç”¨æ–™ç´€éŒ„èˆ‡åˆ†æ</h3>
        <div style="background: #fff; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid #ddd;">
            <div class="form-row">
                <div>
                    <label>æœå°‹æ–™è™Ÿæˆ–å“å</label>
                    <input type="text" id="historySearchInput" placeholder="è¼¸å…¥å¾ŒEnteræœå°‹..." onchange="searchHistoryByInput()">
                </div>
                <div>
                    <label>æˆ–é¸æ“‡é¡åˆ¥</label>
                    <select id="category_history" onchange="renderMaterials('history')">
                        <option value="">-- é¡åˆ¥ --</option>
                        <option value="A">A é¡</option>
                        <option value="B">B é¡</option>
                        <option value="C">C é¡</option>
                        <option value="F">F é¡</option>
                        <option value="H">H é¡</option>
                        <option value="D">D é¡</option>
                    </select>
                </div>
            </div>
            <div id="materialsContainer_history" class="materials-container" style="display:none; margin-bottom:10px;"></div>
            
            <button class="btn-search" style="width:100%; margin-top:10px;" onclick="calculateUsageHistory()">ğŸ“Š é–‹å§‹è¨ˆç®—ç”¨æ–™çµ±è¨ˆ</button>
        </div>

        <div id="historyResult" style="display:none;">
            <div style="padding:10px; background:var(--ukiyo-mid-blue); color:white; border-radius:8px; margin-bottom:15px;">
                <h4 style="margin:0; text-align:center;" id="historyItemTitle">å“åè¦æ ¼</h4>
            </div>

            <div class="history-card">
                <div style="text-align:center; margin-bottom:10px; font-weight:bold; color:#d35400;">ğŸ† ç¸½é«”ç”¨æ–™æ¦‚æ³</div>
                <div class="history-stat-grid">
                    <div class="stat-box"><div class="stat-val" id="totalUsage">0</div><div class="stat-label">æ­·å²ç¸½ç”¨é‡</div></div>
                    <div class="stat-box"><div class="stat-val" id="avgYearly">0</div><div class="stat-label">æ­·å¹´å¹³å‡</div></div>
                </div>
            </div>

            <div class="history-card">
                <div style="text-align:center; margin-bottom:10px; font-weight:bold; color:#2980b9;">ğŸ“… æ­·æœˆç”¨æ–™ç¸½è¨ˆ (1-12æœˆ)</div>
                <div id="monthlyStats" style="display:grid; grid-template-columns: repeat(6, 1fr); gap:5px; font-size:0.8rem; text-align:center;">
                    </div>
            </div>

            <div class="history-card">
                <div style="text-align:center; margin-bottom:10px; font-weight:bold; color:#27ae60;">ğŸ‚ æ­·å­£ç”¨æ–™ç¸½è¨ˆ</div>
                <div class="history-stat-grid">
                    <div class="stat-box"><div class="stat-val" id="season1">0</div><div class="stat-label">Q1 (1-3æœˆ)</div></div>
                    <div class="stat-box"><div class="stat-val" id="season2">0</div><div class="stat-label">Q2 (4-6æœˆ)</div></div>
                    <div class="stat-box"><div class="stat-val" id="season3">0</div><div class="stat-label">Q3 (7-9æœˆ)</div></div>
                    <div class="stat-box"><div class="stat-val" id="season4">0</div><div class="stat-label">Q4 (10-12æœˆ)</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-analysis" class="container-3d">
      <h3 class="section-title">ğŸ“Š å­˜è²¨é è­¦åˆ†æå ±å‘Š</h3>
      <div class="form-row-3" style="background: #fff3cd; padding:15px; border-radius:10px; margin-bottom:20px;">
        <div style="grid-column: 1 / -1;"><strong>âš ï¸ è¨­å®šå®‰å…¨å­˜é‡ (é è­¦å€¼)</strong></div>
        <div><label>æ–™è™Ÿ</label><input type="text" id="safePartNo" placeholder="è¼¸å…¥å®Œæ•´æ–™è™Ÿ"></div>
        <div><label>å®‰å…¨å­˜é‡</label><input type="number" id="safeQty" placeholder="ä¾‹å¦‚: 10"></div>
        <div><label>å‹•ä½œ</label><button class="btn-search" style="background:#e67e22; width:100%" onclick="setSafetyStock()">è¨­å®šé è­¦</button></div>
      </div>

      <div id="analysisReport"></div>
    </div>

  </div>

  <div class="ukiyo-signature" onclick="toggleSignature(this)">
    è¨­è¨ˆäººï¼š<span id="sigName" hidden>ä¸‰æœ¨</span>
  </div>

<script>
// --- è³‡æ–™åº« (å®Œæ•´è³‡æ–™) ---
const rawData = {
  A: `1030420013 æ‡¸å‚ç¤™å­ Cå‹ 10000ç£… 6"Ï† ç°è‰²
1030420014 æ‡¸å‚ç¤™å­ Cå‹ 15000ç£… Ï†10" ç°è‰²
1030480000 èšåˆè£è…³ç¤™å­ 11.4KV å¤¾ç·šå‹
1030480007 é˜²ç›¬è£è…³ç¤™å­ 11.4KV ç„¡è…³
1030500000 èšåˆæŸ±å‹ç¤™å­ 11.4kV
1030520001 æ‹‰ç·šç¤™å­ ä½å£“ å¤§å‹ L139.7ãœ
1030520006 è»¸å‹ç¤™å­ ä½å£“ è»¸å‹`,
  B: `1006000006 è·¯ç‡ˆé–‹é—œ 1P 240Vac 135A éæ°´éŠ€å¼
1006000011 è·¯ç‡ˆé–‹é—œ 1P 240Vac 135A é›»ç£å¼
1006060005 é»æ»…å™¨ 220Vac 5A 5~100lux
1012020037 é›»åŠ›ä¿éšªçµ² 25kV 65E 12.5kA
1012020038 é›»åŠ›ä¿éšªçµ² 25kV 125E 12.5kA
1012020054 é™æµç†”çµ² 15.5kV 40A 25kA é™„æŠ‘å¼§é–‹é—œ
1012030005 é›»åŠ›ä¿éšªçµ²çµ„æ¶ˆéŸ³å™¨ 25KV 200A
1012060002 ç†”çµ²éˆ 3A Hå‹ SURGE PROOF
1012060004 ç†”çµ²éˆ 6A Kå‹
1012060007 ç†”çµ²éˆ 10A Kå‹
1012060010 ç†”çµ²éˆ 15A Kå‹
1012060015 ç†”çµ²éˆ 25A Tå‹
1012060019 ç†”çµ²éˆ 40A Tå‹
1012060023 ç†”çµ²éˆ 65A Tå‹
1016000000 èºæ “é– é–é‰¤:5ãœÏ† é–é‰¤:é‹ èºæ “:SS400 æ “æ¶µ:é‚é‹çŸ½åˆé‡‘
1016050113 é–‹é—œç®± å±‹å¤–å‹ ä¸é½é‹¼ 600x400x230ãœ T2ãœ
1028500019 é…é›»ç·šè·¯é›»æ¡¿åå…‰æ¨™èªç‰‡ CNS 4345æ„Ÿå£“å‹ç¬¬1ç´š 33x12ãè‡ªé»å¼Y193
1028500025 é…é›»ç·šè·¯é›»æ¡¿ååå…‰è²¼ç´™ PVC 40x10ã èœ‚å·¢ç‹€/é»ƒè‰² è‡ªé»å¼
1028500186 é…é›»ç·šè·¯é›»æ¡¿åå…‰è²¼ç´™ ééå±¤ç«‹æ–¹è§’éŒä¹‹å¾®ç¨œé¡åå°„ææ–™ 90x100ã é»ƒé»‘ç›¸é–“è‰²
1028500187 é…é›»ç·šè·¯é›»æ¡¿åå…‰è²¼ç´™ ééå±¤ç«‹æ–¹è§’éŒä¹‹å¾®ç¨œé¡åå°„ææ–™ 90x60ã é»ƒé»‘ç›¸é–“è‰²
1028600042 é›»æ¡¿ç‰Œ é‹ 220Ã—90Ã—T0.511ãœ è—åº•ç™½å­—
1028600062 é›»æ¡¿ç‰Œ é‹ 220Ã—90Ã—T0.6ãœ è—åº•ç™½å­—
1030020030 è¢«è¦†ç“·ç½© é™¶ç“· 11.4KVæ¡¿ä¸Šè®Šå£“å™¨ç”¨ 90Ï†x95Ï†xH95ãœ
1104000184 å£“æ¥ç«¯å­ éŠ… AWG #1 é–‰å£å‹ çŸ­å‹ 1å­” 13ãœÏ†
1104000197 å£“æ¥ç«¯å­ éŠ… 250MCM é–‰å£å‹ çŸ­å‹ 1å­” 13ãœÏ†
1104000198 å£“æ¥ç«¯å­ éŠ… 250MCM é–‰å£å‹ çŸ­å‹ 2å­” 13ãœÏ†
1104000201 å£“æ¥ç«¯å­ éŠ… 500MCM é–‰å£å‹ é•·å‹ 2å­” 15ãœÏ† å±‹å¤–çµ‚ç«¯ç”¨
1104000202 å£“æ¥ç«¯å­ éŠ… AWG 2/0 é–‰å£å‹ çŸ­å‹ 1å­” 13ãœÏ†
1104000203 å£“æ¥ç«¯å­ éŠ… AWG 2/0 é–‰å£å‹ çŸ­å‹ 2å­” 13ãœÏ†
1104030022 å£“æ¥å¥—ç®¡ éŠ… 22ãœÂ² éŠ…è£½
1104030025 å£“æ¥å¥—ç®¡ éŠ… 60ãœÂ² éŠ…è£½
1104030026 å£“æ¥å¥—ç®¡ éŠ… 100ãœ2 éŠ…è£½
1104030037 å£“æ¥å¥—ç®¡ éŠ… AWG 2/0 éŠ…ééŒ«
1104030038 å£“æ¥å¥—ç®¡ éŠ… 250MCM éŠ…ééŒ«
1104030044 å£“æ¥å¥—ç®¡ AAC AWG #2 é‹è£½
1104030045 å£“æ¥å¥—ç®¡ AWG 4/0 é‹è£½
1104030046 å£“æ¥å¥—ç®¡ AAC 300MCM é‹è£½
1104030047 å£“æ¥å¥—ç®¡ AAC 477MCM é‹è£½
1104030072 è·³ç·šå¥—ç®¡ AAC 477MCM(19) é‹è£½
1104060000 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…14-22Ã—8 Î±å‹
1104060001 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…14-38Ã—14-38 Î²å‹
1104060002 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…60Ã—8-38 Î±å‹
1104060003 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…60-100Ã—60-100 Î²å‹
1104060004 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…60-125Ã—22-60 Î²å‹
1104060005 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…2/0-250MCMÃ—#4-2/0 Î²å‹
1104060007 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A#2-6,C38-14Ã—A#2-#6,C38-14
1104060008 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A#2,C60-38Ã—A#2-#6,C38-14
1104060014 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A4/0,C100Ã—A4/0,C100
1104060015 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A4774/0,C200-125Ã—A2/0#6,C60-14
1104060017 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A4774/0C200-125Ã—A4/02/0C100-60
1104060018 Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A477300C250150Ã—A477300C250150
1104060022 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…250-250 Î²å‹
1104060023 Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…125-125 Î²å‹
1104090000 æ¥ç·šç’° éŠ…ç·š 6.5ãœÏ†
1104090002 æ¥ç·šç’° AAC AWG #2-#6
1104090005 æ¥ç·šç’° AAC 477MCM-AWG 4/0
1112120016 é›»æ¡¿ç¶å¸¶ è¤‡åˆé›»æ¡¿ç”¨Bå‹ Ï†235Ã—75Ã—6ãœ
1112160000 é›»æ¡¿æ¨æœ¨å›ºå®šå¸¶ éµè£½
1112160003 å››è·¯æª”æ‹‰å¸¶ Ï†340ãœ éµè£½ é›™æ¡¿åˆä½µç”¨
1120100010 äº’é€£å™¨ é–“æ¥å‹A / 477MCM XLPE
1120100011 äº’é€£å™¨ é–“æ¥å‹B / AWG #2 XLPE
1120100012 äº’é€£ç¹© Bå‹/ 112ã
1120100013 äº’é€£ç¹© Aå‹ / 52ã
1120100014 äº’é€£å™¨ å¤¾æ¢å‹A / 477MCM XLPE
1120100015 äº’é€£å™¨ å¤¾æ¢å‹B / AWG #2 XLPE
1120120024 æ´»ç·šç·šå¤¾ éŠ…ç·š M8-60ãœ2,T8-50ãœ2
1120140002 æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 22-38ãœÂ²
1120140004 æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 50-80ãœ2
1120140007 æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 100-150ãœÂ²
1120140014 æ‹‰ç·šå¤¾æ¿ é‹ç·š AWG 2/0-#2
1120140020 æ‹‰ç·šå¤¾æ¿ é‹ç·š 477MCM-300MCM-AWG 4/0
1120240000 Vå‹æ›éµ Aå‹ç„¡ç¸« SS400
1120240003 é›»å®¹å™¨çµ„éµæ¶ å–®ç›¸ 100KVAR 6å°ç”¨ éé‹…é‹¼
1120240007 ä½å£“ç·šæ¶ å–®ç·šå¼ éé‹…é‹¼ é™„éµé–‚
1120240009 ä½å£“ç·šæ¶ ä¸‰ç·šå¼ éé‹…é‹¼ é™„éµé–‚
1120240011 ä½å£“ç·šæ¶ äº”ç·šå¼ éé‹…é‹¼ é™„éµé–‚
1120240015 ä¼¸å‡ºéµæ¶ æ¨™æº–å¼ éé‹…é‹¼
1120260003 äºŒå­”éµç‰‡ Bå‹ 220Ã—38Ã—T4.5ãœ éé‹…éµ
1120260021 éµé–‚ å–®çœ¼ Ï†5/8"Ã—1800ãœ éµéé‹…
1120280001 é ‚æ¢¢ 11kV é˜²ç›¬è£è…³ç¤™å­ SS400
1120280002 æ©«æ“”æ¢¢ 11kV é˜²ç›¬è£è…³ç¤™å­ SS400
1120320003 æˆå‹æ”¯ç·šå¤¾æ¢ GSW 55ãœ2 è¥¯åœˆå‹ L890ãœ
1120340014 æ©«æ“”æŠ¼ L800ãœ
1120340019 è§’å‹æ©«æ“”æŠ¼ L1000ãœ
1120340021 è§’å‹æ©«æ“”æŠ¼ L1420ãœ
1120340023 è§’å‹æ©«æ“”æŠ¼ L1745ãœ
1122260057 æ”¯æ¶ #1é›»çºœå›ºå®šå¸¶ç”¨ Lå‹ 135Ã—92.5Ã—72Ã—T3ãœ 304SST
1122260058 æ”¯æ¶ 500MCMé›»çºœå›ºå®šå¸¶ç”¨ Lå‹140x92.5x87xT3ãœ 304SST
1210000000 å­”è“‹å®šä½æ¨™ç¤ºå™¨ 66.3kHz æ¸¬æ·±50ã H050å‹
1210000001 å­”è“‹å®šä½æ¨™ç¤ºå™¨ 169.8kHz æ¸¬æ·±50ã H050å‹
1404010030 éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—140ãœ é™„å–®èºå¸½
1404010032 éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—210ãœ é™„å–®èºå¸½
1404010033 éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—240ãœ é™„å–®èºå¸½
1404010034 éé‹…æ–¹é ­èºæ “ SGD290-D M16Ã—P2.0Ã—270ãœ é™„å–®èºå¸½
1404010035 éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—300ãœ é™„å–®èºå¸½
1404010036 éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—350ãœ é™„å–®èºå¸½
1404010038 éé‹…æ–¹é ­èºæ “ SGD290-D M16Ã—P2.0Ã—450ãœ é™„å–®èºå¸½
1404050083 éé‹…æ–¹é ­èºæ “ SS400 5/8"-11UNCx40ãœ é™„å–®èºå¸½
1404140000 éé‹…å…¨ç‰™èºæ “ SGD290-D M16xP2.0x450ãœ é™„4åªæ–¹èºå¸½
1404230039 ç¢³é‹¼æ“´å¼µèºæ “ S45C Hå…§ç‰™å¤–è¿«å¼ 5/8"Ï†x2-1/2"
1404310021 ç¢³é‹¼å–®çœ¼èºæ “ SGD290-D M16xP2.0x270ãœ é™„é›™èºå¸½
1404310023 ç¢³é‹¼å–®çœ¼èºæ “ SGD290-D M16xP2.0x450ãœ é™„ä¸‰èºå¸½
1404310026 ç¢³é‹¼æ”¯ç·šèºæ “ SGD290-D M16xP2.0x500ãœ é™„å››èºå¸½
1404310028 ç¢³é‹¼æ”¯ç·šèºæ “ SGD290-D M16xP2.0x300ãœ é™„é›™èºå¸½
1406010030 éé‹…æ–¹å¢Šåœˆ SS400 M16 18ãœÏ†x4.5ãœ L52xW52ãœ
1808360000 é‰»é…¸é‹…ç³Š 1ç£…è£ æè¦Y413
1818050011 æ£‰ç´—æ‰‹å¥— æ£‰ç´—å«æ£‰é‡100ï¼… L250ãœ é›»å·¥ç”¨
1900000069 éè¼‰ä¿è­·ç†”çµ² 13.8kV 25kVA å–®ç›¸äº­ç½®å¼è®Šå£“å™¨
1900000070 éè¼‰ä¿è­·ç†”çµ² 6.9kV 25kVA/13.8kV 50kVA å–®ç›¸äº­ç½®å¼è®Šå£“å™¨
1900000071 éè¼‰ä¿è­·ç†”çµ² 6.9kV 50kVA/13.8kV 100kVAå–®ç›¸äº­ç½®å¼è®Šå£“å™¨
1900000072 éè¼‰ä¿è­·ç†”çµ² 6.9kV100kVA/13.8kV167kVAå–®ç›¸äº­ç½®å¼è®Šå£“å™¨
1900000073 éè¼‰ä¿è­·ç†”çµ² 6.9kV 167kVA å–®ç›¸äº­ç½®å¼è®Šå£“å™¨`,
  C: `1028560003 æ”¯ç·šæ¨™ç¤ºç®¡ PE 34Ï†xT2ãœxL1.8M
1030060071 é›»çºœç”¨å¡‘è† å¸¶ T0.178ãœxW19ãœxL20M
1030060072 é›»çºœç”¨å¡‘è† å¸¶ T0.178ãœxW38ãœxL20M
1030060074 è‡ªèæ€§é˜²æ°´è† å¸¶ T1.7ãœxW38ãœxL305ã
1030060077 é›»çºœç”¨çµ•ç·£è† è†å¸¶ T3.175ãœxW38.1ãœxL152ã
1100010005 ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 22ãœÂ²
1100010011 ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 60ãœÂ²
1100010015 ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 100ãœÂ²
1100010027 å…¨é‹ç·š 300MCM 19è‚¡
1100040000 é‹¼å¿ƒé‹ç·š AWG #2 6/1
1102000000 15kVäº¤é€£PEé¢¨é›¨ç·š 1C AAC 477MCM äº¤é€£PEè¢«è¦† é»‘è‰²
1102000001 15kVäº¤é€£PEé¢¨é›¨ç·š 1C ACSR AWG #2 äº¤é€£PEè¢«è¦† é»‘è‰²
1102000019 25KVäº¤é€£PEé›»åŠ›é›»çºœ 1C éŠ… AWG #1 éŠ…ç·šé®è”½ é»‘è‰²PVCè¢«è¦†
1102000021 25KVäº¤é€£PEé›»åŠ›é›»çºœ 1C éŠ… 500MCM éŠ…ç·šé®è”½ é»‘è‰²PVCè¢«è¦†
1102000024 25KVäº¤é€£PEé›»åŠ›é›»çºœ 1CéŠ…AWG #1 éŠ…ç·šé®è”½ é»‘è‰²PVCè¢«è¦†åŠ å°¼é¾è¢«è¦†
1102000025 25KVäº¤é€£PEé›»åŠ›é›»çºœ 1CéŠ…500MCM éŠ…ç·šé®è”½ é»‘è‰²PVCè¢«è¦†åŠ å°¼é¾è¢«è¦†
1102000035 25kVäº¤é€£PEé¢¨é›¨ç·š 1C ACSR AWG #2 äº¤é€£PEè¢«è¦†é»‘è‰²
1102000043 25KVäº¤é€£PEå¼•æ¥ç·š 1C éŠ… 22ãœ2 äº¤é€£PEè¢«è¦† è¢«è¦†é¡è‰²é»‘è‰²
1102050055 600V PVCé›»ç·š 1C éŠ… 22ãœ2 é»‘è‰²
1102050067 600V PVCé›»ç·š 1C éŠ… 60ãœ2 é»‘è‰²
1102050089 600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG #2 ç°è‰²
1102050090 600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG #2 è—è‰²
1102050093 600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG 4/0 è—è‰²
1102050095 600V PVCé¢¨é›¨ç·š 1C éŠ… 8ãœ2 é»‘è‰²
1102050097 600V PVCé¢¨é›¨ç·š 1C éŠ… 22ãœ2 é»‘è‰²
1102050099 600V PVCé¢¨é›¨ç·š 1C éŠ… 60ãœ2 é»‘è‰²
1102050101 600V PVCé¢¨é›¨ç·š 1C éŠ… 125ãœ2 é»‘è‰²
1102050204 600V PVCæ¥æˆ¶é›»çºœ 2C éŠ… 8ãœ2
1102050206 600V PVCæ¥æˆ¶é›»çºœ 2C éŠ… 22ãœ2
1102050209 600V PVCæ¥æˆ¶é›»çºœ 3C éŠ… 8ãœ2
1102050211 600V PVCæ¥æˆ¶é›»çºœ 3C éŠ… 22ãœ2
1102100007 600Väº¤é€£PEé›»çºœ 1C éŠ… AWG 2/0 é»‘è‰²
1102100008 600Väº¤é€£PEé›»çºœ 1C éŠ… AWG 2/0 é»ƒè‰²
1102100009 600Väº¤é€£PEé›»çºœ 1C éŠ… 250MCM é»‘è‰²
1102100010 600Väº¤é€£PEé›»çºœ 1C éŠ… 250MCM é»ƒè‰²
1102100038 600Väº¤é€£PEé›»çºœ 1C é‹ 250MCM é»‘è‰²
1108000001 è»ŸéŠ…ç´®ç·š 2.6ãœÏ† è»ŸéŠ…
1108000002 è»ŸéŠ…ç´®ç·š 3.2ãœÏ† è»ŸéŠ…
1108000005 PVCé‹ç´®ç·š AWG #4 é‹ PVCè¢«è¦†
1108000006 PVCé‹ç´®ç·š AWG #6 é‹ PVCè¢«è¦†
1108000007 é‹ç´®ç·š AWG #4 é‹
1108000008 é‹ç´®ç·š AWG #6 é‹
1114000022 é å¼µå¼é›»çºœçµ‚ç«¯æ¥é ­ å±‹å¤–å‹ 25kV 1C éŠ… AWG #1
1114000024 é é‘„å‹é›»çºœçµ‚ç«¯æ¥é ­ å±‹å¤–å‹ 25kV 1C éŠ… 500MCM
1114000026 é å¼µå¼é›»çºœçµ‚ç«¯æ¥é ­ å±‹å¤–å‹ 25kV 1C éŠ… 500MCM
1114030000 é å¼µå¼é›»çºœç›´ç·šæ¥é ­ 600V 1C éŠ… AWG 2/0
1114030001 é å¼µå¼é›»çºœç›´ç·šæ¥é ­ 600V 1C éŠ… 250MCM
1114030012 é é‘„å‹é›»çºœç›´ç·šæ¥é ­ 25kV 1C éŠ… AWG #1
1114030014 é é‘„å‹é›»çºœç›´ç·šæ¥é ­ 25kV 1C éŠ… 500MCM
1114030018 é å¼µå¼é›»çºœåˆ†æ­§æ¥é ­ 600V 1C éŠ… AWG 2/0~250MCM
1114030019 çŒè† å¼é›»çºœåˆ†æ­§æ¥é ­ 600V 1C éŠ… AWG 2/0~250MCM
1114030039 é é‘„å‹é›»çºœç›´ç·šæ¥é ­ 25kV 1C éŠ… AWG #1 å¥—ç®¡å…å£“ç¸®å¼
1114060001 å¥—ç®¡æ’é ­ 25kV 200A AWG #1
1114060008 è² è¼‰å¯åˆ‡è‚˜å‹ç«¯é ­ 25kV 200A AWG #1 æœ‰é›»å£“æ¸¬è©¦é»
1114060011 è² è¼‰ä¸å¯åˆ‡è‚˜å‹ç«¯é ­ 25kV 600A 500MCM æœ‰é›»å£“æ¸¬è©¦é»
1114060015 æ’é ­å°å¥— 25kV 200A AWG #1
1114060017 æ’é ­å°å¥— 25kV 600A 500MCM
1114060019 é›™é€šæ’é ­ 25kV 200A AWG #1
1114060021 é›™é€šå¥—ç®¡æ’é ­ 25kV 200A AWG #1
1114060025 å››è·¯åˆ†æ­§æ’é ­ 25kV 200A AWG #1
1114060026 å››è·¯åˆ†æ­§æ’é ­ 25kV 200A AWG #1 Aé¡é…é›»ç®±ç”¨
1114060028 éš”é›¢æ’é ­ 25kV 200A AWG #1
1120340001 ç´ ææœ¨æ©«æ“” L1200Ã—90Ã—90ãœ
1120340002 ç´ ææœ¨æ©«æ“” L1800Ã—90Ã—90ãœ
1120340008 æ¥æˆ¶æ©«æœ¨ 60Ã—60ãœ
1120340010 è¼•é‹¼æ©«æ“” L1800Ã—75Ã—75Ã—T2.3ãœ
1120340011 è¼•é‹¼æ©«æ“” L2400Ã—75Ã—75Ã—T2.3ãœ
1122050001 é›»çºœä¿è­·éµ å°å‹ SS400 3"Ï† L2500ãœ
1122200007 é›»çºœå›ºå®šå¸¶ #1 AWG é‹åˆé‡‘ 25KV AWG #1 å–®æ¢
1122200014 é›»çºœå›ºå®šå¸¶ 500MCM é‹åˆé‡‘ 25KV 500MCM å–®æ¢
1124140000 ç®¡è·¯å°å¡ RP-03å‹ 80ãœÏ† ä¸€èˆ¬ç”¨
1124140002 ç®¡è·¯å°å¡ RP-05å‹ 125ãœÏ† ä¸€èˆ¬ç”¨
1124140003 ç®¡è·¯å°å¡ PP-05å‹ 125ãœÏ† ç©ºç®¡é˜²æ°´ç”¨
1124140004 ç®¡è·¯å°å¡ RP-06å‹ 150ãœÏ† ä¸€èˆ¬ç”¨
1124140005 ç®¡è·¯å°å¡ PP-06å‹ 150ãœÏ† ç©ºç®¡é˜²æ°´ç”¨
1124140006 ç®¡è·¯å°å¡ PP-21å‹ 150ãœÏ† 25KV AWG #1é›»çºœé˜²æ°´ç”¨
1124140007 ç®¡è·¯å°å¡ PP-25å‹ 150ãœÏ† 25KV 500MCMé›»çºœé˜²æ°´ç”¨
1124140008 ç®¡è·¯å°å¡ PS-21å‹ 150ãœÏ† 25KV AWG #1é›»çºœé˜²æ½›å‹•ç”¨
1124140009 ç®¡è·¯å°å¡ PS-25å‹ 150ãœÏ† 25KV 500MCMé›»çºœé˜²æ½›å‹•ç”¨
1124140032 ç®¡è·¯å°å¡ PSN-25å‹ 150ãœÏ† 25kV 500MCM é›»çºœé˜²æ½›å‹•ç”¨
1124140033 ç®¡è·¯å°å¡ PSN-21å‹ 150ãœÏ† 25kV AWG #1 é›»çºœé˜²æ½›å‹•ç”¨
1400530108 éé‹…ç­‰é‚Šè§’é‹¼ SS400 90Ã—90Ã—T10ãœ
1400530151 éé‹…ç­‰é‚Šè§’é‹¼ SS400 90Ã—90Ã—T10Ã—L1800ãœ
1402010026 éé‹…éµç·š SWM BWG#8 (Ï†4.19ãœ)
1402030003 éé‹…é‹¼çµç·š 55ãœÂ² (Ï†3.2ãœÃ—7è‚¡) æ”¯ç·šç”¨ Sæ’š
1600030012 PVCç¡¬ç®¡ E52(2")
1600030035 PVCç¡¬ç®¡ ES-1 80(3")
1610380004 UPVCç®¡å¸½(ç®¡å¡é ­) 3"(80ãœ)Ï† T2.7ãœ ES-1ç®¡
1610380005 UPVCç®¡å¸½(ç®¡å¡é ­) 5"(125ãœ)Ï† T4.1ãœ ES-1ç®¡
1610380006 UPVCç®¡å¸½(ç®¡å¡é ­) 6"(150ãœ)Ï† T5.1ãœ ES-1ç®¡
1804090005 çŸ³æ²¹é†š å·¥æ¥­ç´š ç„¡è‰²é€æ˜æ¶² 450mLè£
1808140035 é›»çºœæ½¤æ»‘è† 5åŠ ä¾–è£ 0~60â„ƒ æè¦Y221
1822810000 ä¸é½é‹¼æŸç·Šå¸¶ 304SST 0.2~0.3ãœÃ—20ãœÃ—1500ãœ
1822810001 ä¸é½é‹¼æŸç·Šå¸¶ 304SST 0.2~0.3ãœÃ—20ãœÃ—1700ãœ
1895020025 ç™½ç´°å¸ƒ W3FT 12ç£…`,
  F: `1000010059 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 10kVA
1000010064 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA
1000010066 æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA
1000010067 å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA ä¸é½é‹¼
1000010068 éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA
1000010074 æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA
1000010075 å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA ä¸é½é‹¼
1000010076 éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA
1000010079 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA
1000010080 æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA
1000010081 å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA ä¸é½é‹¼
1000010082 éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA
1000010083 æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 167kVA
1000010127 äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 25kVA ç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­
1000010131 äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 25kVA ç›´å¼é™„åˆ†æ¥é ­
1000010133 äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 50kVA ç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­
1000010139 äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 100kVAç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­
1000010171 äº­ç½®å¼è®Šå£“å™¨ ä¸‰ç›¸ 12/24kV 500kVA é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­
1000010217 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA ä¸é½é‹¼
1000010218 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA ä¸é½é‹¼
1000010222 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 240/120V 25kVA ä¸éŠ¹é‹¼
1000010225 æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 240/120V 167kVA ä¸éŠ¹é‹¼
1004030005 é«˜å£“é›»å®¹å™¨ å–®ç›¸ 6.9kV 100kVAR å±‹å¤–å‹
1004030006 é«˜å£“é›»å®¹å™¨ å–®ç›¸ 6.9kV 200kVAR å±‹å¤–å‹
1008010002 é›»å®¹å™¨ç”¨æ²¹é–‹é—œ å–®ç›¸ 14.4kV 200A æ‰‹å‹•/é›»å‹• 115Vac
1008040003 åœ°ä¸‹å››è·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 24kV 600A 2S2F 24Vç°¡æ˜“å‹(Ié‡æ¸¬)
1008040009 åœ°ä¸‹å››è·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸24kV600A 2S2F 24Vç°¡æ˜“å‹(I+Vé‡æ¸¬)
1008040011 åœ°ä¸‹å››è·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸24kV600A 2S2F 24VRTUå‹(I+Vé‡æ¸¬)
1008040013 æ¶ç©ºè‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 24kV 600A 24V RTUå‹
1008040014 æ¶ç©ºè‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 24kV 600A 24V ç°¡æ˜“å‹(I+Vé‡æ¸¬)
1008040015 åœ°ä¸‹äºŒè·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 24kV 600A 24V ç°¡æ˜“å‹(I+Vé‡æ¸¬)
1016050117 è®Šå£“å™¨ç®±é«” äº­ç½®å¼è®Šå£“å™¨ç”¨ ç»ç’ƒçº–ç¶­`,
  H: `1006000012 ç·šè·¯é–‹é—œ 1P 14.4KV 600A æ°£å°å¼
1006000016 ç†”çµ²éˆé–‹é—œ 14.4kV 100A
1006000021 ç†”çµ²éˆé–‹é—œ 25kV 100A
1006000025 è² è¼‰å•Ÿæ–·é–‹é—œ 3P 14.4KV 600A æ°£å°å¼ è‡ªå‹•å‹
1006030018 æ–·è·¯å™¨ 3P 600V 225A å±‹å¤–å‹
1006030019 æ–·è·¯å™¨ 3P 600V 400A å±‹å¤–å‹
1006030030 æ–·è·¯å™¨ 3P 600V 100A å•Ÿæ–·å®¹é‡10KA`,
  D: `1016050116 é›»è¡¨ç®± å–®ç›¸ 320x340x190ãœ
1016050119 é›»è¡¨ç®± ä¸‰ç›¸ 450x370x205ãœ
1200000001 ç“¦æ™‚å–®ç›¸æ’åº§å‹é›»è¡¨ å–®ç›¸ä¸‰ç·šå¼ 110/220V 30(200)A 60Hz
1200000003 ç“¦æ™‚ä¸‰ç›¸æ’åº§å‹é›»è¡¨ ä¸‰ç›¸ä¸‰ç·šå¼ 110-220V 30(200)A 60Hz
1200000005 ç“¦æ™‚ä¸‰ç›¸æ’åº§å‹é›»è¡¨ ä¸‰ç›¸å››ç·šå¼ 220/380V 30(200)A 60Hz
1200020001 ç“¦æ™‚å–®ç›¸åº•åº§å‹é›»è¡¨ å–®ç›¸ä¸‰ç·šå¼ 110/220V 30(200)A 60Hz
1200020003 ç“¦æ™‚ä¸‰ç›¸åº•åº§å‹é›»è¡¨ ä¸‰ç›¸ä¸‰ç·šå¼ 110-220V 30(200)A 60Hz
1200020005 ç“¦æ™‚ä¸‰ç›¸åº•åº§å‹é›»è¡¨ ä¸‰ç›¸å››ç·šå¼ 220/380V 30(200)A 60Hz`
};

// --- å…¨åŸŸè®Šæ•¸èˆ‡åˆå§‹åŒ– ---
const materials = {};
let selectedMaterial = null;
let currentMode = 'stockin';

window.onload = function() {
  parseRawData();
  document.getElementById('mainDate').valueAsDate = new Date();
  document.getElementById('transferDate').valueAsDate = new Date();
  loadLogs();
  renderInventoryTable();
  updateAnalysis();
};

function parseRawData() {
  for (const cat in rawData) {
    const lines = rawData[cat].split('\n');
    materials[cat] = lines.map(line => {
      const parts = line.trim().split(' ');
      const partNo = parts[0];
      const name = parts.slice(1).join(' ');
      return { partNo, name };
    }).filter(item => item.partNo);
  }
}

// --- åˆ‡æ› Tab ---
function switchTab(tabName) {
  document.querySelectorAll('.container-3d').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
  
  document.getElementById(`tab-${tabName}`).classList.add('active');
  // æ‰¾å‡ºå°æ‡‰æŒ‰éˆ•ä¸¦ active (é€™è£¡ç°¡åŒ–è™•ç†ï¼Œç›´æ¥æ ¹æ“š onclick å…§å®¹)
  const btns = document.querySelectorAll('.nav-btn');
  btns.forEach(btn => {
    if(btn.onclick.toString().includes(tabName)) btn.classList.add('active');
  });

  if (tabName === 'search') loadLogs();
  if (tabName === 'inventory') renderInventoryTable();
  if (tabName === 'analysis') updateAnalysis();
}

// --- é¡¯ç¤ºææ–™åˆ—è¡¨ (é€šç”¨) ---
// usageContext: 'input' (Tab1), 'stock' (Tab3), 'history' (Tab5)
function renderMaterials(usageContext) {
  let catSelectId, containerId;
  
  if (usageContext === 'input') {
      catSelectId = 'category';
      containerId = 'materialsContainer_input';
  } else if (usageContext === 'stock') {
      catSelectId = 'category_stock';
      containerId = 'materialsContainer_stock';
  } else if (usageContext === 'history') {
      catSelectId = 'category_history';
      containerId = 'materialsContainer_history';
  }

  const cat = document.getElementById(catSelectId).value;
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  container.style.display = 'flex'; // ç¢ºä¿é¡¯ç¤º

  if (!cat) {
    container.innerHTML = '<div style="color:#888; text-align:center;">è«‹é¸æ“‡ææ–™é¡åˆ¥</div>';
    return;
  }

  materials[cat].forEach(m => {
    const div = document.createElement('div');
    div.className = 'material-btn';
    div.textContent = `${m.partNo} - ${m.name}`;
    div.onclick = () => selectMaterial(m, div, usageContext);
    container.appendChild(div);
  });
}

function selectMaterial(m, element, usageContext) {
  // UI Highlight
  const containerId = (usageContext === 'input') ? 'materialsContainer_input' : 
                      (usageContext === 'stock') ? 'materialsContainer_stock' : 'materialsContainer_history';
  
  document.querySelectorAll(`#${containerId} .material-btn`).forEach(b => b.classList.remove('active'));
  element.classList.add('active');
  
  selectedMaterial = m;

  if (usageContext === 'input') {
      document.getElementById('partNoInput').value = m.partNo;
      document.getElementById('qtySection').style.display = 'block';
  } else if (usageContext === 'stock') {
      document.getElementById('stockPartNo').value = m.partNo;
      document.getElementById('stockSelectedName').textContent = m.name;
      // éš±è—åˆ—è¡¨è®“ç•«é¢æ›´ä¹¾æ·¨
      document.getElementById('materialsContainer_stock').style.display = 'none';
  } else if (usageContext === 'history') {
      document.getElementById('historySearchInput').value = m.partNo;
      // éš±è—åˆ—è¡¨
      document.getElementById('materialsContainer_history').style.display = 'none';
      calculateUsageHistory(); // è‡ªå‹•è§¸ç™¼è¨ˆç®—
  }
}

// --- æ–™è™Ÿè¼¸å…¥è™•ç† ---
function handlePartNoInput(val, mode) {
  if (val.length < 4) return;
  // å°‹æ‰¾å°æ‡‰ææ–™
  let found = null;
  for (const cat in materials) {
    const match = materials[cat].find(m => m.partNo === val);
    if (match) {
      found = match;
      if (mode === 'normal') {
          document.getElementById('category').value = cat;
          renderMaterials('input'); // é‡æ–°æ¸²æŸ“åˆ—è¡¨
          // è‡ªå‹•é¸ä¸­
          setTimeout(() => {
             const btns = document.querySelectorAll('#materialsContainer_input .material-btn');
             btns.forEach(btn => {
               if(btn.textContent.includes(val)) {
                 btn.click();
                 btn.scrollIntoView({ behavior: 'smooth', block: 'center' });
               }
             });
          }, 100);
      } else if (mode === 'transfer') {
          document.getElementById('transferItemName').value = match.name;
      }
      break;
    }
  }
  if (!found && mode === 'transfer') document.getElementById('transferItemName').value = "æŸ¥ç„¡æ­¤æ–™è™Ÿ";
}

function handleStockPartNoInput(val) {
   if (val.length < 4) return;
   for (const cat in materials) {
     const match = materials[cat].find(m => m.partNo === val);
     if(match) {
        document.getElementById('stockSelectedName').textContent = match.name;
        document.getElementById('category_stock').value = cat;
        return;
     }
   }
   document.getElementById('stockSelectedName').textContent = "æœªæ‰¾åˆ°å°æ‡‰å“å";
}


// --- è³‡æ–™å„²å­˜ (Tab 1) ---
document.getElementById('materialForm').addEventListener('submit', function(e) {
  e.preventDefault();
  if (!selectedMaterial) { alert('è«‹å…ˆé¸æ“‡ææ–™'); return; }

  const record = {
    date: document.getElementById('mainDate').value,
    type: document.getElementById('transType').value,
    orderNo: document.getElementById('orderNo').value,
    person: document.getElementById('personName').value,
    staff: document.getElementById('staffName').value,
    partNo: selectedMaterial.partNo,
    name: selectedMaterial.name,
    qty: parseInt(document.getElementById('qty').value),
    unit: document.getElementById('unit').value,
    evalType: document.getElementById('evalType').value,
    timestamp: new Date().toISOString()
  };

  saveRecord(record);
  alert('âœ… è³‡æ–™å·²å„²å­˜ï¼');
  this.reset();
  document.getElementById('materialsContainer_input').innerHTML = '';
  document.getElementById('qtySection').style.display = 'none';
  selectedMaterial = null;
  // é‡ç½®æ—¥æœŸ
  document.getElementById('mainDate').valueAsDate = new Date();
});

function saveRecord(record) {
  let logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  logs.push(record);
  localStorage.setItem('materialLogs', JSON.stringify(logs));
  updateStockFromRecord(record);
}

// --- åº«å­˜é‚è¼¯ ---
function getStock() {
  return JSON.parse(localStorage.getItem('materialStock')) || {};
}

function saveStock(stockData) {
  localStorage.setItem('materialStock', JSON.stringify(stockData));
}

function setInitialStock() {
  const pNo = document.getElementById('stockPartNo').value;
  const qty = parseInt(document.getElementById('stockInitQty').value);
  if (!pNo || isNaN(qty)) { alert('è«‹è¼¸å…¥å®Œæ•´æ–™è™Ÿèˆ‡æ•¸é‡'); return; }
  
  // å˜—è©¦æ‰¾å“å
  let pName = document.getElementById('stockSelectedName').textContent;
  if(pName === 'ç„¡' || pName === 'æœªæ‰¾åˆ°å°æ‡‰å“å') {
      // å˜—è©¦å†æ¬¡æœå°‹
      for (const cat in materials) {
        const m = materials[cat].find(x => x.partNo === pNo);
        if(m) { pName = m.name; break; }
      }
  }

  const stockData = getStock();
  if (!stockData[pNo]) {
    stockData[pNo] = { init: 0, current: 0, name: pName };
  }
  
  // é‡æ–°è¨ˆç®—ç•¶å‰åº«å­˜ (ä¿ç•™ç•°å‹•ç´€éŒ„å½±éŸ¿ï¼Œåªæ”¹åˆå§‹å€¼)
  const oldInit = stockData[pNo].init || 0;
  const diff = qty - oldInit;
  
  stockData[pNo].init = qty;
  stockData[pNo].current = (stockData[pNo].current || 0) + diff;
  stockData[pNo].name = pName; // æ›´æ–°å“å

  saveStock(stockData);
  alert(`âœ… æ–™è™Ÿ ${pNo} åˆå§‹åº«å­˜è¨­å®šç‚º ${qty}`);
  renderInventoryTable();
  document.getElementById('stockPartNo').value = '';
  document.getElementById('stockInitQty').value = '';
  document.getElementById('stockSelectedName').textContent = 'ç„¡';
  document.getElementById('materialsContainer_stock').innerHTML = '';
  document.getElementById('category_stock').value = '';
}

function updateStockFromRecord(r) {
  const stockData = getStock();
  if (!stockData[r.partNo]) {
    stockData[r.partNo] = { init: 0, current: 0, name: r.name };
  }
  
  let change = 0;
  // æ¶ˆè€—é¡ (æ¸›å°‘åº«å­˜)
  if (['é ˜æ–™', 'å€Ÿç”¨', 'èª¿å‡º', 'ç§»å‡º'].includes(r.type)) {
    change = -r.qty;
  } 
  // å¢åŠ é¡ (å¢åŠ åº«å­˜)
  else if (['é€€æ–™', 'é€²è²¨', 'èª¿å…¥', 'ç§»å…¥'].includes(r.type)) {
    change = r.qty;
  }

  stockData[r.partNo].current += change;
  saveStock(stockData);
}

function renderInventoryTable() {
  const stockData = getStock();
  const logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  const filter = document.getElementById('filterStockInput').value.toLowerCase();
  const tbody = document.getElementById('inventoryBody');
  tbody.innerHTML = '';

  Object.keys(stockData).forEach(pNo => {
    const item = stockData[pNo];
    if (filter && !pNo.includes(filter) && !item.name.includes(filter)) return;

    // è¨ˆç®—ç•°å‹•ç¸½è¨ˆ (é©—ç®—ç”¨)
    const totalChange = item.current - item.init;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${pNo}</td>
      <td>${item.name}</td>
      <td>${item.init}</td>
      <td style="color:${totalChange >=0 ? 'green':'red'}">${totalChange > 0 ? '+'+totalChange : totalChange}</td>
      <td style="font-weight:900; font-size:1.1rem;">${item.current}</td>
    `;
    tbody.appendChild(tr);
  });
}

// --- æ­·å²æŸ¥è©¢ (Tab 2) ---
function loadLogs() {
  const logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  renderLogs(logs);
}

function renderLogs(logs) {
  const list = document.getElementById('logList');
  list.innerHTML = '';
  logs.sort((a,b) => b.timestamp.localeCompare(a.timestamp)); // æ–°çš„åœ¨å‰

  if (logs.length === 0) { list.innerHTML = '<div style="text-align:center;color:#999">å°šç„¡ç´€éŒ„</div>'; return; }

  logs.forEach((log, index) => {
    const div = document.createElement('div');
    div.className = 'record-li';
    div.innerHTML = `
      <div style="font-weight:bold; color:var(--ukiyo-deep-blue); margin-bottom:5px;">
        ${log.date} | ${log.type} | å–®è™Ÿ:${log.orderNo}
      </div>
      <div style="font-size:1.1rem; margin-bottom:5px;">
        ${log.partNo} ${log.name} <span style="color:var(--danger-red); font-weight:900;">x ${log.qty} ${log.unit || ''}</span>
      </div>
      <div style="color:#666; font-size:0.9rem;">
        å°è±¡: ${log.person} | ç¶“è¾¦: ${log.staff} ${log.evalType ? `| è©•:${log.evalType}` : ''}
      </div>
      <button class="btn-delete" onclick="deleteLog(${index})">åˆªé™¤</button>
    `;
    list.appendChild(div);
  });
}

function deleteLog(index) {
  if(!confirm('ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿåº«å­˜å°‡æœƒå›æ»¾ã€‚')) return;
  let logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  const target = logs[index]; // åŸå§‹é™£åˆ—å› ç‚ºè¢« sort éï¼Œé€™è£¡ index å¯èƒ½æœƒéŒ¯ï¼Œå»ºè­°æ”¹ç”¨ timestamp æ‰¾
  
  // ç°¡å–®è§£æ³•ï¼šé€™è£¡çš„ index æ˜¯ render å¾Œçš„ï¼Œéœ€è¦é‡æ–°å°æ‡‰
  // ç‚ºäº†æ­£ç¢ºåˆªé™¤ï¼Œæˆ‘å€‘ç›´æ¥åœ¨ render æ™‚å‚³å…¥çœŸå¯¦ index å¤ªéº»ç…©ï¼Œ
  // æ”¹ç‚ºç”¨ filter ç§»é™¤ç‰¹å®š timestamp (å‡è¨­å”¯ä¸€)
  const newLogs = logs.filter(l => l.timestamp !== target.timestamp);
  
  // å›æ»¾åº«å­˜
  const stockData = getStock();
  if (stockData[target.partNo]) {
    let reverseChange = 0;
    if (['é ˜æ–™', 'å€Ÿç”¨', 'èª¿å‡º', 'ç§»å‡º'].includes(target.type)) reverseChange = target.qty;
    else if (['é€€æ–™', 'é€²è²¨', 'èª¿å…¥', 'ç§»å…¥'].includes(target.type)) reverseChange = -target.qty;
    stockData[target.partNo].current += reverseChange;
    saveStock(stockData);
  }

  localStorage.setItem('materialLogs', JSON.stringify(newLogs));
  loadLogs(); // é‡æ•´
  renderInventoryTable(); // é‡æ•´åº«å­˜
}

function filterRecords() {
  const logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  const pName = document.getElementById('searchPerson').value.toLowerCase();
  const sName = document.getElementById('searchStaff').value.toLowerCase();
  const pNo = document.getElementById('searchPartNo').value.toLowerCase();
  const month = document.getElementById('searchMonth').value; // YYYY-MM

  const filtered = logs.filter(l => {
    const matchPerson = !pName || l.person.toLowerCase().includes(pName);
    const matchStaff = !sName || l.staff.toLowerCase().includes(sName);
    const matchPart = !pNo || l.partNo.includes(pNo) || l.name.includes(pNo);
    const matchDate = !month || l.date.startsWith(month);
    return matchPerson && matchStaff && matchPart && matchDate;
  });
  renderLogs(filtered);
}

function clearFilters() {
  document.getElementById('searchPerson').value = '';
  document.getElementById('searchStaff').value = '';
  document.getElementById('searchPartNo').value = '';
  document.getElementById('searchMonth').value = '';
  loadLogs();
}

// --- é€²è²¨/èª¿æ’¥/ç§»è½‰ (Tab 4) ---
function setTransferMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    
    document.getElementById('stockInFields').style.display = 'none';
    document.getElementById('transferFields').style.display = 'none';
    document.getElementById('warehouseFields').style.display = 'none';

    if (mode === 'stockin') {
        document.getElementById('modeStockIn').classList.add('active');
        document.getElementById('stockInFields').style.display = 'block';
    } else if (mode === 'transfer') {
        document.getElementById('modeTransfer').classList.add('active');
        document.getElementById('transferFields').style.display = 'block';
    } else if (mode === 'warehouse') {
        document.getElementById('modeWarehouse').classList.add('active');
        document.getElementById('warehouseFields').style.display = 'block';
    }
}

function processStockIn() {
    const date = document.getElementById('transferDate').value;
    const orderNo = document.getElementById('transferOrderNo').value;
    const partNo = document.getElementById('transferPartNo').value;
    const name = document.getElementById('transferItemName').value;
    const qty = parseInt(document.getElementById('stockInQty').value);
    const staff = document.getElementById('stockInStaff').value;

    if (!partNo || !qty || !staff) { alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š'); return; }

    const record = {
        date, type: 'é€²è²¨', orderNo, person: 'å» å•†/ç¸½è™•', staff, partNo, name, qty, unit: 'å€‹', evalType: '', timestamp: new Date().toISOString()
    };
    saveRecord(record);
    alert('âœ… é€²è²¨å…¥åº«æˆåŠŸï¼');
    clearTransferForm();
}

function processTransfer() {
    const date = document.getElementById('transferDate').value;
    const orderNo = document.getElementById('transferOrderNo').value;
    const partNo = document.getElementById('transferPartNo').value;
    const name = document.getElementById('transferItemName').value;
    const targetUnit = document.getElementById('transferTargetUnit').value;
    const typeKey = document.getElementById('transferType').value; // transfer_in or transfer_out
    const qty = parseInt(document.getElementById('transferQty').value);
    const staff = document.getElementById('transferStaff').value;

    if (!partNo || !qty || !targetUnit) { alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š'); return; }

    const typeName = (typeKey === 'transfer_in') ? 'èª¿å…¥' : 'èª¿å‡º';
    const record = {
        date, type: typeName, orderNo, person: targetUnit, staff, partNo, name, qty, unit: 'å€‹', evalType: '', timestamp: new Date().toISOString()
    };
    saveRecord(record);
    alert(`âœ… ${typeName}æˆåŠŸï¼`);
    clearTransferForm();
}

function processWarehouseTransfer() {
    const date = document.getElementById('transferDate').value;
    const orderNo = document.getElementById('transferOrderNo').value;
    const partNo = document.getElementById('transferPartNo').value;
    const name = document.getElementById('transferItemName').value;
    const whTarget = document.getElementById('warehouseTarget').value;
    const typeKey = document.getElementById('warehouseType').value;
    const qty = parseInt(document.getElementById('warehouseQty').value);
    const staff = document.getElementById('warehouseStaff').value;

    if (!partNo || !qty) { alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š'); return; }

    const typeName = (typeKey === 'transfer_in') ? 'ç§»å…¥' : 'ç§»å‡º';
    const record = {
        date, type: typeName, orderNo, person: whTarget, staff, partNo, name, qty, unit: 'å€‹', evalType: '', timestamp: new Date().toISOString()
    };
    saveRecord(record);
    alert(`âœ… å€‰åº«${typeName}æˆåŠŸï¼`);
    clearTransferForm();
}

function clearTransferForm() {
    document.getElementById('transferPartNo').value = '';
    document.getElementById('transferItemName').value = '';
    document.getElementById('stockInQty').value = '';
    document.getElementById('transferQty').value = '';
    document.getElementById('warehouseQty').value = '';
}

// --- æ­·å²ç”¨æ–™ç´€éŒ„èˆ‡åˆ†æ (Tab 5 - æ–°å¢) ---
function searchHistoryByInput() {
    const val = document.getElementById('historySearchInput').value;
    if(val) calculateUsageHistory(val);
}

function calculateUsageHistory(directInputPartNo) {
    let pNo = directInputPartNo;
    
    // å¦‚æœæ²’æœ‰ç›´æ¥å‚³å…¥ï¼Œå˜—è©¦å¾è¼¸å…¥æ¡†æˆ–é¸æ“‡ç‹€æ…‹æ‹¿
    if (!pNo) {
        pNo = document.getElementById('historySearchInput').value;
    }

    if (!pNo && !selectedMaterial) {
        alert("è«‹å…ˆé¸æ“‡é¡åˆ¥é¸å–ææ–™ï¼Œæˆ–è¼¸å…¥æ–™è™Ÿæœå°‹");
        return;
    }
    
    // å¦‚æœæ˜¯ç”¨é¸æ“‡çš„
    if (!pNo && selectedMaterial) {
        pNo = selectedMaterial.partNo;
    }

    const logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
    
    // æ‰¾å‡ºå°æ‡‰å“å
    let pName = "æœªçŸ¥å“å";
    if (selectedMaterial && selectedMaterial.partNo === pNo) {
        pName = selectedMaterial.name;
    } else {
        // å¾ log æˆ– rawData æ‰¾
        const found = logs.find(l => l.partNo === pNo);
        if (found) pName = found.name;
    }

    // ç¯©é¸ç´€éŒ„ï¼šé‡å°è©²æ–™è™Ÿï¼Œä¸”å‹•ä½œç‚ºã€Œæ¶ˆè€—æ€§ã€(é ˜æ–™ã€å€Ÿç”¨)
    // è¨»ï¼šæ˜¯å¦åŒ…å«ã€Œèª¿å‡ºã€è¦–éœ€æ±‚è€Œå®šï¼Œæ­¤è™•ä¸»è¦è¨ˆç®—ä½¿ç”¨é‡ï¼Œæ•…ä»¥é ˜æ–™ç‚ºä¸»
    const usageLogs = logs.filter(l => 
        l.partNo === pNo && (l.type === 'é ˜æ–™' || l.type === 'å€Ÿç”¨')
    );

    let totalUsage = 0;
    const yearStats = {}; // { '2023': 100, '2024': 50 }
    const monthStats = new Array(12).fill(0); // [0..11] Jan-Dec
    const seasonStats = [0, 0, 0, 0]; // Q1, Q2, Q3, Q4

    usageLogs.forEach(l => {
        const d = new Date(l.date);
        const y = d.getFullYear();
        const m = d.getMonth(); // 0-11
        const qty = parseInt(l.qty) || 0;

        totalUsage += qty;

        // å¹´çµ±è¨ˆ
        if (!yearStats[y]) yearStats[y] = 0;
        yearStats[y] += qty;

        // æœˆçµ±è¨ˆ (æ­·æœˆç´¯è¨ˆ)
        monthStats[m] += qty;

        // å­£çµ±è¨ˆ
        const season = Math.floor(m / 3); // 0, 1, 2, 3
        seasonStats[season] += qty;
    });

    // è¨ˆç®—å¹³å‡
    const yearsCount = Object.keys(yearStats).length || 1;
    const avgYearly = (totalUsage / yearsCount).toFixed(1);

    // æ¸²æŸ“ UI
    document.getElementById('historyResult').style.display = 'block';
    document.getElementById('historyItemTitle').textContent = `${pNo} ${pName}`;
    document.getElementById('totalUsage').textContent = totalUsage;
    document.getElementById('avgYearly').textContent = avgYearly;

    document.getElementById('season1').textContent = seasonStats[0];
    document.getElementById('season2').textContent = seasonStats[1];
    document.getElementById('season3').textContent = seasonStats[2];
    document.getElementById('season4').textContent = seasonStats[3];

    // æ¸²æŸ“æœˆå ±è¡¨
    const monthContainer = document.getElementById('monthlyStats');
    monthContainer.innerHTML = '';
    const months = ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
    months.forEach((mLabel, idx) => {
        const div = document.createElement('div');
        div.style.cssText = "background:#f9f9f9; padding:5px; border-radius:5px;";
        div.innerHTML = `<div style="color:#666">${mLabel}</div><div style="font-weight:bold; color:#2980b9">${monthStats[idx]}</div>`;
        monthContainer.appendChild(div);
    });
}


// --- åˆ†æé æ¸¬ (Tab 6) ---
function setSafetyStock() {
  const pNo = document.getElementById('safePartNo').value;
  const qty = parseInt(document.getElementById('safeQty').value);
  if (!pNo || isNaN(qty)) { alert('è«‹è¼¸å…¥'); return; }

  const settings = JSON.parse(localStorage.getItem('safetyStockSettings')) || {};
  settings[pNo] = qty;
  localStorage.setItem('safetyStockSettings', JSON.stringify(settings));
  alert(`âœ… æ–™è™Ÿ ${pNo} å®‰å…¨å­˜é‡è¨­å®šç‚º ${qty}`);
  updateAnalysis();
}

function updateAnalysis() {
  const settings = JSON.parse(localStorage.getItem('safetyStockSettings')) || {};
  const stockData = getStock();
  const report = document.getElementById('analysisReport');
  report.innerHTML = '';

  let hasAlert = false;
  
  Object.keys(settings).forEach(pNo => {
    const safeQty = settings[pNo];
    const current = stockData[pNo] ? stockData[pNo].current : 0;
    const name = stockData[pNo] ? stockData[pNo].name : 'æœªçŸ¥';

    if (current < safeQty) {
      hasAlert = true;
      const div = document.createElement('div');
      div.style.cssText = 'background:#ffebee; border-left:5px solid red; padding:15px; margin-bottom:10px; border-radius:5px;';
      div.innerHTML = `
        <strong>âš ï¸ åº«å­˜ä¸è¶³è­¦å ±</strong><br>
        æ–™è™Ÿ: ${pNo} (${name})<br>
        ç›®å‰åº«å­˜: <span style="color:red; font-weight:bold; font-size:1.2rem;">${current}</span> (ä½æ–¼å®‰å…¨å€¼ ${safeQty})
      `;
      report.appendChild(div);
    }
  });

  if (!hasAlert) {
    report.innerHTML = '<div style="text-align:center; color:green; padding:20px;">âœ… ç›®å‰æ‰€æœ‰ç›£æ§é …ç›®åº«å­˜æ­£å¸¸</div>';
  }
}

// --- Excel åŒ¯å‡ºåŠŸèƒ½ ---
function openExportModal() {
  document.getElementById('exportModal').style.display = 'flex';
}
function closeExportModal() {
  document.getElementById('exportModal').style.display = 'none';
}
function confirmExport() {
  const logs = JSON.parse(localStorage.getItem('materialLogs')) || [];
  if (logs.length === 0) { alert('ç„¡è³‡æ–™å¯åŒ¯å‡º'); return; }

  const start = document.getElementById('exportStart').value;
  const end = document.getElementById('exportEnd').value;
  const cols = Array.from(document.querySelectorAll('.export-col:checked')).map(c => c.value);

  const filtered = logs.filter(l => {
    if (start && l.date < start) return false;
    if (end && l.date > end) return false;
    return true;
  });

  if (filtered.length === 0) { alert('è©²å€é–“ç„¡è³‡æ–™'); return; }

  const colMap = {
    date: 'ç•°å‹•æ—¥æœŸ', type: 'é¡å‹', orderNo: 'å–®è™Ÿ', partNo: 'æ–™è™Ÿ',
    name: 'å“å', qty: 'æ•¸é‡', unit: 'å–®ä½', person: 'å°è±¡',
    staff: 'ç¶“è¾¦äºº', evalType: 'è©•åƒ¹', timestamp: 'ç´€éŒ„æ™‚é–“'
  };

  const data = filtered.map(item => {
    const row = {};
    cols.forEach(k => row[colMap[k]] = item[k]);
    return row;
  });

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ææ–™ç´€éŒ„");
  XLSX.writeFile(wb, `Material_Log_${new Date().toISOString().slice(0,10)}.xlsx`);
  closeExportModal();
}

function toggleSignature(el) {
    const span = document.getElementById('sigName');
    span.hidden = !span.hidden;
}
</script>
</body>
</html>
